/*
simpletest
requires when: https://github.com/cujojs/when
1.0.2 add when
1.0.1 added assertIsTruthy, propsNotEqual

*/
function Test(a){this.tests=[];this.title="Unit Tests for unnamed project";$.extend(this,a);
if(!this.output){this.output=$("div");}this._test_count=0;this._fail_count=0;this.timerStart=function(){var b=new Date();
this.time=b.getTime();};this.timerEnd=function(){var b=new Date();return(b.getTime()-this.time);
};}Test.prototype={constructor:Test,addError:function(a,d,c){var b=c?"Passed":"<b>Failed</b>";
this.output.append("<span>"+b+" test "+this._test_count+": "+a+' in test "'+d+'"</span><br>');
if(!c){this._fail_count++;}},startTest:function(){if(this.timer){this.timerStart();
}this._test_count++;},runTest:function(d,a){var b,c=this.iterations||1;for(b=0;b<c;
b++){if(typeof d==="function"){d=d();}a(d);}},endTest:function(b,a){var d,c=false;
if(this.timer){d=this.timerEnd();if(!b){b="success";c=true;}b="("+d+" ms) "+b;}if(b){this.addError(b,a,c);
}},addTest:function(a,b){var c={name:a,test:b};this.tests.push(c);},_arrayEq:function(a,b){var c,d;
if(!(a.length&&(a.length>-1))){d="Test case has no length property";}if(!(b.length&&(b.length>-1))){d="Expected value has no length property";
}if(!d&&a.length!==b.length){d="Arrays different length (test: "+a.length+", expected: "+b.length;
}if(!d){for(c=0;c<a.length;c++){if(a[c]!==b[c]){d="Arrays not equal starting at element "+c+".";
break;}}}return d;},assertEq:function(d,c,a){var b;this.startTest();this.runTest(d,function(e){if(typeof e!==typeof c){b='Test case type "'+typeof e+'" != expected type "'+typeof c+'"';
}if(!b&&e!==c){b='"'+e+'" != "'+c+'"';}});this.endTest(b,a);},assertNotEq:function(e,c,a,d){var b;
this.startTest();this.runTest(e,function(f){if(typeof f===typeof c&&f===c){b='"'+f+'" === "'+c+'"';
}});this.endTest(b,a);},assertIsTruthy:function(d,a,c){var b;this.startTest();this.runTest(d,function(e){if(!e){b='Test case object of type "'+typeof e+'" is not truthy.';
}});this.endTest(b,a);},assertPropsEq:function(h,d,b,g,f){var e=this,c;function a(j,l,k,m){if(j&&j!==l){for(var i in l){if(l.hasOwnProperty(i)){if(j[i]===undefined){c="Property "+i+" in "+m+" does not exist in "+k;
break;}if(j instanceof Array&&l instanceof Array){c=e._arrayEq(j,l);break;}if(typeof j[i]==="object"&&typeof l[i]==="object"){c=a(j[i],l[i],k+"."+i,m+"."+i);
break;}if(j[i]!==l[i]){c="Property "+i+" in "+k+" does not match same property in "+m;
break;}}}}if(f){if(!c){c="The two objects had the same properties.";}else{c=null;
}}return c;}this.startTest();this.runTest(h,function(i){if(typeof i!=="object"||typeof d!=="object"){c="Test cases are not both objects";
}if(!c){c=a(i,d,"test","expected");}if(!c){c=a(d,i,"expected","testcase");}});this.endTest(c,b);
},assertPropsNotEq:function(d,b,a,c){this.assertPropsEq(d,b,a,c,true);},assertArrayEq:function(f,c,a,e){var b,d;
d=this;this.startTest();this.runTest(f,function(g){b=d._arrayEq(g,c);});this.endTest(b,a);
},assertArrayElementsEq:function(h,e,c,g){var f=this,d,a,b;this.startTest();this.runTest(h,function(i){a=i;
b=e;a.sort();b.sort();d=f._arrayEq(a,b);});this.endTest(d,c);},assertCsvElementsEq:function(h,e,c,g){var d,a,b,f;
f=this;this.startTest();this.runTest(h,function(i){if(typeof i!=="string"){d="test case is not a string";
}else{a=i.split(",");b=e.split(",");a.sort();b.sort();d=f._arrayEq(a,b);}});this.endTest(d,c);
},assertInstanceOf:function(e,c,a){var b,d=eval("testcase instanceof "+c);this.startTest();
this.runTest(e,function(f){if(!d){b='testcase is not an instance of "'+c+'"';}});
this.endTest(b,a);},run:function(h){var d,a,f=false,e=this;function g(i){if(!f){this.output.append('<h1>"'+this.title+'"</h1><br /><hr /><br />');
}this._test_count=0;this._fail_count=0;this.output.append('<h2>Test Group "'+i.name+'"</h2><br />==============================<br />');
}function c(){var i="Completed "+this._test_count+" tests. ";if(this._fail_count>0){i+=" "+this._test_count-this._fail_count+" passed, "+this._fail_count+" failed.";
}else{i+=" PASSED.";}this.output.append(i+"<br />");this.output.append("==============================<br />");
}if(this.timer){this.iterations=5;}a=0;function b(){for(d=a;d<e.tests.length;d++){if(!h||e.tests[d].name===h){g.call(e,e.tests[d]);
e.tests[d].test(e);c.call(e);}}a=d;window.setTimeout(function(){if(a<e.tests.length){b();
}},500);}b();this.output.append("<hr /");}};