/* ImageMapster
   Version: see $.mapster.version

Copyright 2011 James Treworgy
http://www.outsharked.com/imagemapster
https://github.com/jamietre/ImageMapster

A jQuery plugin to enhance image maps.
*/
(function(a){a.fn.mapster=function(d){var c=a.mapster.impl;
if(a.isFunction(c[d])){return c[d].apply(this,Array.prototype.slice.call(arguments,1))
}else{if(typeof d==="object"||!d){return c.bind.apply(this,arguments)
}else{a.error("Method "+d+" does not exist on jQuery.mapster")
}}};
a.mapster={version:"1.2.5b27",render_defaults:{fade:false,fadeDuration:150,altImage:null,altImageOpacity:0.7,fill:true,highlight:null,fillColor:"000000",fillColorMask:"FFFFFF",fillOpacity:0.5,stroke:false,strokeColor:"ff0000",strokeOpacity:1,strokeWidth:1,includeKeys:"",alt_image:null},defaults:{render_highlight:{fade:true},render_select:{fade:false},staticState:null,selected:false,isSelectable:true,isDeselectable:true,singleSelect:false,wrapClass:null,wrapCss:null,onGetList:null,sortList:false,listenToList:false,mapKey:"",mapValue:"",listKey:"value",listSelectedAttribute:"selected",listSelectedClass:null,showToolTip:false,toolTipFade:true,toolTipClose:["area-mouseout"],onClick:null,onMouseover:null,onMouseout:null,onStateChange:null,onShowToolTip:null,boundList:null,onCreateTooltip:null,onConfigured:null,configTimeout:10000,noHrefIsMask:true,scaleMap:true,safeLoad:false,areas:[]},area_defaults:{toolTip:"",includeKeys:"",isMask:false},canvas_style:{position:"absolute",left:0,top:0,padding:0,border:0},hasCanvas:null,isTouch:null,windowLoaded:false,map_cache:[],utils:{subclass:function(d,c){var e=new d(),f=function(){e.constructor.apply(this,arguments);
c.apply(this,arguments)
};
f.prototype=e.constructor.prototype;
return f
},asArray:function(c){return c.constructor===Array?c:this.split(c,",")
},split:function(e){var d,c=e.split(",");
for(d=c.length-1;
d>=0;
d--){c[d]=a.trim(c[d]);
if(!c[d]){c=c.splice(d,1)
}}return c
},setOpacity:function(c,d){if(!a.mapster.hasCanvas){c.style.filter="Alpha(opacity="+String(d*100)+")"
}else{c.style.opacity=d
}},updateProps:function(c,d){var e,f=c||{},g=a.isEmptyObject(f)?d:c;
e=[];
a.each(g,function(h){e.push(h)
});
a.each(Array.prototype.slice.call(arguments,1),function(h,j){a.each(j||{},function(k,l){if(!e||a.inArray(k,e)>=0){var i=j[k];
if(typeof i!=="undefined"){if(i&&i.constructor==={}.constructor){f[k]=a.extend(f[k]||{},i)
}else{if(i&&i.constructor===Array){f[k]=i.slice(0)
}else{f[k]=j[k]
}}}}})
});
return f
},isElement:function(c){return(typeof HTMLElement==="object"?c instanceof HTMLElement:c&&typeof c==="object"&&c.nodeType===1&&typeof c.nodeName==="string")
},indexOfProp:function(c,d,f){var e=c.constructor===Array?-1:null;
a.each(c,function(h,g){if(g&&(d?g[d]:g)===f){e=h;
return false
}});
return e
},boolOrDefault:function(d,c){return this.isBool(d)?d:c||false
},isBool:function(c){return typeof c==="boolean"
},ifFunction:function(d,e,c){if(a.isFunction(d)){d.call(e,c)
}},isImageLoaded:function(c){if(typeof c.complete!=="undefined"&&!c.complete){return false
}if(typeof c.naturalWidth!=="undefined"&&(c.naturalWidth===0||c.naturalHeight===0)){return false
}return true
},fader:(function(){var c={},e=0,d=function(g,k,h,f){var i,j,l=a.mapster.utils;
if(typeof g==="number"){j=c[g];
if(!j){return
}}else{i=l.indexOfProp(c,null,g);
if(i){delete c[i]
}c[++e]=j=g;
g=e
}h=h||1;
k=(k+(h/10)>h-0.01)?h:k+(h/10);
l.setOpacity(j,k);
if(k<h){setTimeout(function(){d(g,k,h,f)
},f?f/10:15)
}};
return d
}())},getBoundList:function(g,e){if(!g.boundList){return null
}var c,d,h=a(),f=e.split(",");
g.boundList.each(function(){for(c=0;
c<f.length;
c++){d=f[c];
if(a(this).is("["+g.listKey+'="'+d+'"]')){h=h.add(this)
}}});
return h
},setBoundListProperties:function(c,e,d){e.each(function(){if(c.listSelectedClass){if(d){a(this).addClass(c.listSelectedClass)
}else{a(this).removeClass(c.listSelectedClass)
}}if(c.listSelectedAttribute){a(this).attr(c.listSelectedAttribute,d)
}})
},getMapDataIndex:function(e){var d,c;
switch(e.tagName&&e.tagName.toLowerCase()){case"area":c=a(e).parent().attr("name");
d=a("img[usemap='#"+c+"']")[0];
break;
case"img":d=e;
break
}return d?this.utils.indexOfProp(this.map_cache,"image",d):-1
},getMapData:function(d){var c=this.getMapDataIndex(d);
if(c>=0){return c>=0?this.map_cache[c]:null
}},queueCommand:function(e,f,d,c){if(!e){return false
}if(!e.complete){e.commands.push({that:f,command:d,args:c});
return true
}return false
},unload:function(){this.impl.unload();
this.utils=null;
this.impl=null;
a.fn.mapster=null;
a.mapster=null;
a("*").unbind()
}};
var b=a.mapster;
b.Method=function(g,d,c,f){var e=this;
e.output=g;
e.input=g;
e.first=f.first||false;
e.args=f.args?Array.prototype.slice.call(f.args,0):null;
e.key=f.key;
e.name=f.name;
e.func_map=d;
e.func_area=c;
e.name=f.name
};
b.Method.prototype.go=function(){var f,e,c,g,j,k=this.input,d=[],h=this;
g=k.length;
for(f=0;
f<g;
f++){e=a.mapster.getMapData(k[f]);
if(e){if(b.queueCommand(e,this.input,this.name,this.args)){if(this.first){j=""
}continue
}c=e.getData(k[f].nodeName==="AREA"?k[f]:this.key);
if(c){if(a.inArray(c,d)<0){d.push(c)
}}else{j=this.func_map.apply(e,this.args)
}if(this.first||typeof j!=="undefined"){break
}}}a(d).each(function(){j=h.func_area.apply(this,h.args)
});
if(typeof j!=="undefined"){return j
}else{return this.output
}};
a.mapster.impl=(function(){var e={},d=a.mapster,i=a.mapster.utils,h,c;
a.extend(d.defaults,d.render_defaults);
a.extend(d.area_defaults,d.defaults);
c=function(j){return d.map_cache.push(j)-1
};
h=function(k){d.map_cache.splice(k.index,1);
for(var j=d.map_cache.length-1;
j>=this.index;
j--){d.map_cache[j].index--
}};
function f(n,k){var j,l,m=n.options.areas;
if(k){a.each(k,function(p,o){l=i.indexOfProp(m,"key",this.key);
if(l>=0){a.extend(m[l],this)
}else{m.push(this)
}j=n.getDataForKey(this.key);
if(j){a.extend(j.options,this)
}})
}}function g(j,k){var l=i.updateProps({},k);
delete l.areas;
i.updateProps(j.options,l);
f(j,k.areas);
i.updateProps(j.area_options,j.options);
a.each(j.data,function(n,m){m._effectiveOptions=null
})
}e.get=function(j){return(new d.Method(this,function(){return this.getSelected()
},function(){return this.isSelected()
},{name:"get",args:arguments,key:j,first:true,defaultReturn:""})).go()
};
e.data=function(j){return(new d.Method(this,null,function(){return this
},{name:"data",args:arguments,key:j})).go()
};
e.highlight=function(j){return(new d.Method(this,function(l){if(j===false){this.ensureNoHighlight()
}else{var k=this._highlightId;
return k>=0?this.data[k].key:null
}},function(){this.highlight()
},{name:"highlight",args:arguments,key:j,first:true})).go()
};
e.select=function(){e.set.call(this,true)
};
e.deselect=function(){e.set.call(this,false)
};
e.set=function(q,l,r){var n,p,o,k,m,j=[];
function s(t){if(t){switch(q){case true:t.addSelection();
break;
case false:t.removeSelection(true);
break;
default:t.toggleSelection();
break
}}}k=i.isBool(r)?r:true;
this.each(function(){var t;
o=d.getMapData(this);
if(!o){return true
}m="";
if(a(this).is("img")){if(d.queueCommand(o,a(this),"set",[q,l,k])){return true
}if(l instanceof Array){if(l.length){m=l.join(",")
}}else{m=l
}if(m){a.each(i.split(m),function(v,u){s(o.getDataForKey(u.toString()))
});
if(!q){o.removeSelectionFinish()
}}}else{p=a(this).parent()[0];
if(n&&p!==n){o=d.getMapData(this);
if(!o){return true
}n=p
}n=p;
if(d.queueCommand(o,a(this),"set",[q,l,k])){return true
}t=o.getDataForArea(this);
if(a.inArray(t,j)<0){j.push(t)
}}a.each(j,function(v,u){s(u)
});
if(k&&o.options.boundList){d.setBoundListProperties(o.options,d.getBoundList(o.options,m),q)
}});
return this
};
e.unbind=function(j){return(new d.Method(this,function(){this.clearEvents();
this.clearMapData(j);
h(this)
},null,{name:"unbind",args:arguments})).go()
};
e.rebind=function(j){return(new d.Method(this,function(){g(this,j);
this.setAreaOptions(j.areas||{});
this.redrawSelections()
},null,{name:"rebind",args:arguments})).go()
};
e.get_options=function(l,k){var j=i.isBool(l)?l:k;
return(new d.Method(this,function(){var m=a.extend({},this.options);
if(j){m.render_select=i.updateProps({},d.render_defaults,m,m.render_select);
m.render_highlight=i.updateProps({},d.render_defaults,m,m.render_highlight)
}return m
},function(){return j?this.effectiveOptions():this.options
},{name:"get_options",args:arguments,first:true,key:l})).go()
};
e.set_options=function(j){return(new d.Method(this,function(){g(this,j)
},null,{name:"set_options",args:arguments})).go()
};
e.unload=function(){var j;
for(j=d.map_cache.length-1;
j>=0;
j--){if(d.map_cache[j]){e.unbind.call(a(d.map_cache[j].image))
}}e.graphics=null
};
e.snapshot=function(){return(new d.Method(this,function(){a.each(this.data,function(k,j){j.selected=false
});
this.base_canvas=this.graphics.createVisibleCanvas(this.image);
a(this.image).before(this.base_canvas)
},null,{name:"snapshot"})).go()
};
e.state=function(){var j,k=null;
a(this).each(function(){if(this.nodeName==="IMG"){j=d.getMapData(this);
if(j){k=j.state()
}return false
}});
return k
};
e.bind=function(j){var k=i.updateProps({},d.defaults,j);
return this.each(function(){var l,m,o,n;
l=a(this);
l.css("border",0);
n=d.getMapData(this);
if(n){e.unbind.apply(l);
if(!n.complete){l.bind();
return true
}n=null
}o=this.getAttribute("usemap");
m=o&&a('map[name="'+o.substr(1)+'"]');
if(!(l.is("img")&&o&&m.size()>0)){return true
}if(!n){n=new d.MapData(this,k);
n.index=c(n);
n.map=m;
n.addImage(this);
n.addImage(null,this.src);
if(a.mapster.hasCanvas){n.addImage(null,k.render_highlight.altImage||k.altImage,"highlight");
n.addImage(null,k.render_select.altImage||k.altImage,"select")
}n.bindImages()
}})
};
e.init=function(l){var k,j;
d.hasCanvas=(document.namespaces&&document.namespaces.g_vml_)?false:a("<canvas></canvas>")[0].getContext?true:false;
d.isTouch="ontouchstart" in document.documentElement;
if(!(d.hasCanvas||document.namespaces)){a.fn.mapster=function(){return this
};
return
}if(!i.isBool(a.mapster.defaults.highlight)){d.defaults.highlight=!d.isTouch
}if(i.isBool(l)){d.hasCanvas=l
}if(a.browser.msie&&!d.hasCanvas&&!document.namespaces.v){document.namespaces.add("v","urn:schemas-microsoft-com:vml");
k=document.createStyleSheet();
j=["shape","rect","oval","circ","fill","stroke","imagedata","group","textbox"];
a.each(j,function(n,m){k.addRule("v\\:"+m,"behavior: url(#default#VML); antialias:true")
})
}a(window).bind("load",function(){d.windowLoaded=true;
a(d.map_cache).each(function(){if(!this.complete&&this.isReadyToBind()){this.initialize()
}})
})
};
e.test=function(j){return eval(j)
};
return e
}());
a.mapster.impl.init()
}(jQuery));
(function(a){var c,b=a.mapster,d=b.utils;
b.Graphics=function(e){var f=this;
f.active=false;
f.canvas=null;
f.width=0;
f.height=0;
f.shapes=[];
f.masks=[];
f.map_data=e
};
c=b.Graphics.prototype;
c._addShapeGroupImpl=function(e,h){var g=this,f=g.map_data;
a.each(e.areas,function(k,j){h.isMask=h.isMask||(j.nohref&&f.options.noHrefIsMask);
if(!d.isBool(h.staticState)){g.addShape(j,h)
}});
return h
};
c.begin=function(f,g){var e=a(f);
if(!a.mapster.hasCanvas){this.elementName=g
}this.canvas=f;
this.width=e.width();
this.height=e.height();
this.shapes=[];
this.masks=[];
this.active=true
};
c.addShape=function(f,g){var e=g.isMask?this.masks:this.shapes;
e.push({mapArea:f,options:g})
};
c.createVisibleCanvas=function(e){return a(this.createCanvasFor(e)).addClass("mapster_el").css(b.canvas_style)[0]
};
c.addShapeGroup=function(e,j){var i=this,g,k,f,h=this.map_data,l=e.effectiveRenderOptions(j);
if(j==="select"){k="static_"+e.areaId.toString();
f=h.base_canvas
}else{f=h.overlay_canvas
}i.begin(f,k);
if(l.includeKeys){g=d.split(l.includeKeys);
a.each(g,function(o,n){var m=h.getDataForKey(n.toString());
i._addShapeGroupImpl(m,m.effectiveOptions())
})
}l=i._addShapeGroupImpl(e,l);
i.render();
if(l.fade){d.fader(f,0,1,l.fadeDuration)
}};
if(a.mapster.hasCanvas){c.hex_to_decimal=function(e){return Math.max(0,Math.min(parseInt(e,16),255))
};
c.css3color=function(e,f){return"rgba("+this.hex_to_decimal(e.substr(0,2))+","+this.hex_to_decimal(e.substr(2,2))+","+this.hex_to_decimal(e.substr(4,2))+","+f+")"
};
c.renderShape=function(f,h,j){var g,e=h.coords(null,j);
switch(h.shape){case"rect":f.rect(e[0],e[1],e[2]-e[0],e[3]-e[1]);
break;
case"poly":f.moveTo(e[0],e[1]);
for(g=2;
g<h.length;
g+=2){f.lineTo(e[g],e[g+1])
}f.lineTo(e[0],e[1]);
break;
case"circ":case"circle":f.arc(e[0],e[1],e[2],0,Math.PI*2,false);
break
}};
c.addAltImage=function(e,f,g,h){e.beginPath();
this.renderShape(e,g);
e.closePath();
e.clip();
e.globalAlpha=h.altImageOpacity;
e.drawImage(f,0,0,g.owner.scaleInfo.width,g.owner.scaleInfo.height)
};
c.render=function(){var g,h,i=this,f=i.masks.length,j=i.createCanvasFor(i.canvas),k=j.getContext("2d"),e=i.canvas.getContext("2d");
if(f){g=i.createCanvasFor(i.canvas);
h=g.getContext("2d");
h.clearRect(0,0,g.width,g.height);
a.each(i.masks,function(m,l){h.save();
h.beginPath();
i.renderShape(h,l.mapArea);
h.closePath();
h.clip();
h.lineWidth=0;
h.fillStyle="#000";
h.fill();
h.restore()
})
}a.each(i.shapes,function(l,m){k.save();
if(m.options.alt_image){i.addAltImage(k,m.options.alt_image,m.mapArea,m.options)
}else{if(m.options.fill){k.beginPath();
i.renderShape(k,m.mapArea);
k.closePath();
k.fillStyle=i.css3color(m.options.fillColor,m.options.fillOpacity);
k.fill()
}}k.restore()
});
a.each(i.shapes.concat(i.masks),function(l,n){var m=n.options.strokeWidth===1?0.5:0;
if(n.options.stroke){k.save();
k.strokeStyle=i.css3color(n.options.strokeColor,n.options.strokeOpacity);
k.lineWidth=n.options.strokeWidth;
k.beginPath();
i.renderShape(k,n.mapArea,m);
k.closePath();
k.stroke();
k.restore()
}});
if(f){h.globalCompositeOperation="source-out";
h.drawImage(j,0,0);
e.drawImage(g,0,0)
}else{e.drawImage(j,0,0)
}i.active=false;
return i.canvas
};
c.createCanvasFor=function(g){var f=a(g),j=f.width()||f[0].width,i=f.height()||f[0].height,e=a('<canvas width="'+j+'" height="'+i+'"></canvas>')[0];
return e
};
c.clearHighlight=function(){var e=this.map_data.overlay_canvas;
e.getContext("2d").clearRect(0,0,e.width,e.height)
};
c.removeSelections=function(){};
c.refreshSelections=function(){var e,f=this.map_data;
e=f.base_canvas;
f.base_canvas=this.createVisibleCanvas(f.image);
a(f.base_canvas).hide();
a(e).before(f.base_canvas);
f.redrawSelections();
a(f.base_canvas).show();
a(e).remove()
}
}else{c.renderShape=function(k,m,g){var l=this,n,h,o,j,i,p,f=k.coords();
j=l.elementName?'name="'+l.elementName+'" ':"";
i=g?'class="'+g+'" ':"";
o='<v:fill color="#'+m.fillColor+'" opacity="'+(m.fill?m.fillOpacity:0)+'" /><v:stroke opacity="'+m.strokeOpacity+'"/>';
if(m.stroke){n="strokeweight="+m.strokeWidth+' stroked="t" strokecolor="#'+m.strokeColor+'"'
}else{n='stroked="f"'
}switch(k.shape){case"rect":p="<v:rect "+i+j+' filled="t" '+n+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+f[0]+"px;top:"+f[1]+"px;width:"+(f[2]-f[0])+"px;height:"+(f[3]-f[1])+'px;">'+o+"</v:rect>";
break;
case"poly":p="<v:shape "+i+j+' filled="t" '+n+' coordorigin="0,0" coordsize="'+l.width+","+l.height+'" path="m '+f[0]+","+f[1]+" l "+f.slice(2).join(",")+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+l.width+"px;height:"+l.height+'px;">'+o+"</v:shape>";
break;
case"circ":case"circle":p="<v:oval "+i+j+' filled="t" '+n+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(f[0]-f[2])+"px;top:"+(f[1]-f[2])+"px;width:"+(f[2]*2)+"px;height:"+(f[2]*2)+'px;">'+o+"</v:oval>";
break
}h=a(p);
a(l.canvas).append(h);
return h
};
c.render=function(){var f,e=this;
a.each(this.shapes,function(h,g){e.renderShape(g.mapArea,g.options)
});
if(this.masks.length){a.each(this.masks,function(h,g){f=d.updateProps({},g.options,{fillOpacity:1,fillColor:g.options.fillColorMask});
e.renderShape(g.mapArea,f,"mapster_mask")
})
}this.active=false;
return this.canvas
};
c.createCanvasFor=function(f){var e=a(f),i=e.width(),g=e.height();
return a('<var width="'+i+'" height="'+g+'" style="zoom:1;overflow:hidden;display:block;width:'+i+"px;height:"+g+'px;"></var>')[0]
};
c.clearHighlight=function(){a(this.map_data.overlay_canvas).children().remove()
};
c.removeSelections=function(e){if(e>=0){a(this.map_data.base_canvas).find('[name="static_'+e.toString()+'"]').remove()
}else{a(this.map_data.base_canvas).children().remove()
}};
c.refreshSelections=function(){return null
}
}}(jQuery));
(function(a){var c,b=a.mapster,d=b.utils;
b.MapData=function(e,g){var f=this;
this.index=-1;
this.image=e;
this.options=g;
this.area_options=d.updateProps({},b.area_defaults,g);
this.bindTries=g.configTimeout/200;
this.imgCssText=e.style.cssText||null;
this.initializeDefaults();
this.mousedown=function(h){h.preventDefault()
};
this.mouseover=function(i){var h=f.getDataForArea(this),j;
if(h&&!h.owner.resizing){j=h.effectiveOptions();
f.inArea=true;
if(!a.mapster.hasCanvas){this.blur()
}if(f.currentAreaId===h.areaId){return
}f.clearEffects(true);
h.highlight(!j.highlight);
if(f.options.showToolTip&&j.toolTip){h.showTooltip()
}f.currentAreaId=h.areaId;
if(a.isFunction(f.options.onMouseover)){f.options.onMouseover.call(this,{e:i,options:j,key:h.key,selected:h.isSelected()})
}}};
this.mouseout=function(i){var j,h=f.getDataForArea(this),k=f.options;
if(h&&!h.owner.resizing){f.inArea=false;
f.clearEffects(false);
if(a.isFunction(k.onMouseout)){k.onMouseout.call(this,{e:i,options:k,key:j,selected:h.isSelected()})
}}};
this.clearEffects=function(h){var i=f.options;
if((f.currentAreaId<0||h!==true)&&f.inArea){return
}f.ensureNoHighlight();
if(i.toolTipClose&&a.inArray("area-mouseout",i.toolTipClose)>=0){f.clearTooltip()
}f.currentAreaId=-1
};
this.click=function(k){var p,l,m,n,i,q=this,h=f.getDataForArea(this),o=f.options;
k.preventDefault();
if(!h||h.owner.resizing){return
}if(!a.mapster.hasCanvas){this.blur()
}o=f.options;
function j(r){var s;
i=(r.isSelectable()&&(r.isDeselectable()||!r.isSelected()));
if(i){n=!r.isSelected()
}else{n=r.isSelected()
}m=b.getBoundList(o,r.key);
if(a.isFunction(o.onClick)){if(false===o.onClick.call(q,{e:k,listTarget:m,key:r.key,selected:n})){return
}}if(i){p=r.toggleSelection()
}if(o.boundList&&o.boundList.length>0){b.setBoundListProperties(o,m,r.isSelected())
}s=r.effectiveOptions();
if(s.includeKeys){l=d.split(s.includeKeys);
a.each(l,function(v,u){var t=f.getDataForKey(u.toString());
if(!t.options.isMask){j(t)
}})
}}j(h)
};
this.graphics=new b.Graphics(this)
};
c=b.MapData.prototype;
c.initializeDefaults=function(){this.images=[];
this.imageSources=[];
this.imageStatus=[];
this.altImagesXref={};
this.map=null;
this.base_canvas=null;
this.overlay_canvas=null;
this.imagesAdded=false;
this.imagesLoaded=false;
this.complete=false;
this.commands=[];
this.data=[];
this.originalAreaData=[];
this._xref={};
this._highlightId=-1;
this.currentAreaId=-1;
this._tooltip_events=[];
this.scaleInfo=null;
this.inArea=false
};
c.state=function(){return{complete:this.complete,resizing:this.resizing,zoomed:this.zoomed,zoomedArea:this.zoomedArea,scaleInfo:this.scaleInfo}
};
c.isReadyToBind=function(){return this.imagesAdded&&this.imagesLoaded&&(!this.options.safeLoad||b.windowLoaded)
};
c.addImage=function(g,l,e){var h,f,k,i=this;
function j(){if(i.complete){return
}h=a.inArray(this,i.images);
if(h<0){throw ("Unable to find ref to image '"+this.src+"'.")
}i.imageStatus[h]=true;
if(a.inArray(false,i.imageStatus)<0&&(!i.options.safeLoad||b.windowLoaded)){i.initialize()
}}function m(n){var o=i.images.push(n)-1;
i.imageSources[o]=k;
i.imageStatus[o]=false;
if(e){i.altImagesXref[e]=o
}}if(!g&&!l){return
}f=g;
k=l||a(f).attr("src");
if(!k){throw ("Missing image source")
}if(!f){f=a('<img class="mapster_el" />').hide()[0];
a("body").append(f);
m(f);
a(f).bind("load.mapster",j);
a(f).attr("src",k)
}else{m(f)
}};
c.bindImages=function(g){var e=true,f=this;
f.imagesAdded=true;
if(f.complete){return
}a.each(f.images,function(j,h){if(!d.isImageLoaded(h)){e=false;
return false
}});
f.imagesLoaded=e;
if(f.isReadyToBind()){f.initialize();
return
}if(f.bindTries-->0){window.setTimeout(function(){f.bindImages(true)
},200)
}else{throw ("Images never seemed to finish loading.")
}};
c.altImage=function(e){return this.images[this.altImagesXref[e]]
};
c.wrapId=function(){return"mapster_wrap_"+this.index
};
c._idFromKey=function(e){return this.complete&&typeof e==="string"&&this._xref.hasOwnProperty(e)?this._xref[e]:-1
};
c.getSelected=function(){var e="";
a.each(this.data,function(g,f){if(f.isSelected()){e+=(e?",":"")+f.key
}});
return e
};
c.getDataForArea=function(f){var e,g=a(f).attr(this.options.mapKey);
if(g){g=d.split(g)[0]
}e=this.data[this._idFromKey(g)];
if(e){e.area=f.length?f[0]:f
}else{e.area=null
}return e
};
c.getDataForKey=function(e){return this.data[this._idFromKey(e)]
};
c.getData=function(e){if(typeof e==="string"){return this.getDataForKey(e)
}else{if(e&&e.mapster||d.isElement(e)){return this.getDataForArea(e)
}else{return null
}}};
c.ensureNoHighlight=function(){var e;
if(this._highlightId>=0){this.graphics.clearHighlight();
e=this.data[this._highlightId];
e.changeState("highlight",false);
this._highlightId=-1
}};
c.setHighlightID=function(e){this._highlightId=e
};
c.clearSelections=function(){this.graphics.removeSelections();
a.each(this.data,function(g,f){f.selected=false
})
};
c.setAreaOptions=function(f){var j,g,e,h=f||{};
for(j=h.length-1;
j>=0;
j--){g=h[j];
e=this.getDataForKey(g.key);
if(e){d.updateProps(e.options,g);
if(d.isBool(g.selected)){e.selected=g.selected
}}}};
c.drawSelections=function(g){var e,f=d.asArray(g);
for(e=f.length-1;
e>=0;
e--){this.data[f[e]].drawSelection()
}};
c.redrawSelections=function(){a.each(this.data,function(g,f){if(f.isSelectedOrStatic()){f.drawSelection()
}})
};
c.initialize=function(){var l,z,F,A,e,g,m,C,k,r,t,v,u,h,p,q,s,D,E,o,w,B,n,x=this,y=x.options;
function f(j,G){var i=new b.AreaData(x,j,G,y);
i.areaId=x._xref[j]=x.data.push(i)-1;
return i.areaId
}if(x.complete){return
}x.complete=true;
s=a(x.image);
A=s.parent().attr("id");
if(A&&A.length>=12&&A.substring(0,12)==="mapster_wrap"){F=s.parent();
F.attr("id",x.wrapId())
}else{F=a('<div id="'+x.wrapId()+'"></div>');
if(y.wrapClass){if(y.wrapClass===true){F.addClass(s.attr("class"))
}else{F.addClass(y.wrapClass)
}}}x.wrapper=F;
l=x.graphics.createVisibleCanvas(x.image);
z=x.graphics.createVisibleCanvas(x.image);
x.base_canvas=l;
x.overlay_canvas=z;
x._xref={};
x.data=[];
p=!y.mapKey;
if(p){y.mapKey="data-mapster-key"
}C=(a.browser.msie&&a.browser.version<=7)?"area":(p?"area[coords]":"area["+y.mapKey+"]");
k=a(x.map).find(C);
d.scaleMap(x.image,y.scaleMap,function(i){B=x.scaleInfo=i;
for(r=k.length-1;
r>=0;
r--){h=0;
g=k[r];
e=a(g);
if(!g.coords){continue
}n=p?"":g.getAttribute(y.mapKey);
v=(p||!n)?[""]:d.split(n);
w=new b.MapArea(x,g);
for(t=v.length-1;
t>=0;
t--){u=v[t];
if(y.mapValue){q=e.attr(y.mapValue)
}if(p){h=f(x.data.length,q);
o=x.data[h];
o.key=u=h.toString()
}else{h=x._xref[u];
if(h>=0){o=x.data[h];
if(q&&!x.data[h].value){o.value=q
}}else{h=f(u,q);
o=x.data[h]
}}o.areas.push(w)
}if(!w.nohref){e.bind("mouseover.mapster",x.mouseover).bind("mouseout.mapster",x.mouseout).bind("click.mapster",x.click).bind("mousedown.mapster",x.mousedown)
}if(p){e.attr("data-mapster-key",u)
}}m={display:"block",position:"relative",padding:0,width:B.width,height:B.height};
if(y.wrapCss){a.extend(m,y.wrapCss)
}if(s.parent()[0]!==x.wrapper[0]){s.before(x.wrapper)
}F.css(m);
for(r=1;
r<x.images.length;
r++){F.append(x.images[r])
}a(x.images.slice(1)).hide();
s.css(b.canvas_style);
x.images[1].style.cssText=x.image.style.cssText;
F.append(x.images[1]).append(l).append(z).append(s);
d.setOpacity(x.image,0);
d.setOpacity(x.images[1]);
x.setAreaOptions(y.areas);
if(y.isSelectable&&y.onGetList){E=x.data.slice(0);
if(y.sortList){if(y.sortList==="desc"){D=function(j,G){return j===G?0:(j>G?-1:1)
}
}else{D=function(j,G){return j===G?0:(j<G?-1:1)
}
}E.sort(function(j,G){j=j.value;
G=G.value;
return D(j,G)
})
}x.options.boundList=y.onGetList.call(x.image,E)
}x.redrawSelections();
if(x.commands.length){a.each(x.commands,function(G,j){b.impl[j.command].apply(j.that,j.args)
});
x.commands=[]
}if(y.onConfigured&&typeof y.onConfigured==="function"){y.onConfigured.call(s,true)
}})
};
c.clearEvents=function(){a(this.map).find("area").unbind(".mapster");
a(this.images).unbind(".mapster")
};
c._clearCanvases=function(e){if(!e){a(this.base_canvas).remove()
}a(this.overlay_canvas).remove()
};
c.clearMapData=function(f){var e=this;
this._clearCanvases(f);
a.each(this.data,function(h,g){g.reset(f)
});
this.data=null;
if(!f){this.image.style.cssText=this.imgCssText;
a(this.wrapper).before(this.image).remove()
}a.each(this.images,function(g){if(e.images[g]!==this.image){e.images[g]=null
}});
e.images=[];
this.image=null;
d.ifFunction(this.clearTooltip,this)
};
c.removeSelectionFinish=function(){var e=this.graphics;
e.refreshSelections();
e.clearHighlight()
}
}(jQuery));
(function(a){var c,b=a.mapster,d=b.utils;
b.AreaData=function(f,e,g){this.owner=f;
this.key=e||"";
this.areaId=-1;
this.value=g||"";
this.options={};
this.selected=null;
this.areas=[];
this.area=null;
this._effectiveOptions=null
};
c=b.AreaData.prototype;
c.coords=function(g,f){var e=[];
a.each(this.areas,function(j,h){e=e.concat(h.coords(g,f))
});
return e
};
c.reset=function(e){a.each(this.areas,function(g,f){f.reset(e)
});
this.areas=null;
this.options=null;
this._effectiveOptions=null
};
c.isSelectedOrStatic=function(){var e=this.effectiveOptions();
return d.isBool(this.selected)?this.selected:(d.isBool(e.staticState)?e.staticState:(d.isBool(this.owner.options.staticState)?this.owner.options.staticState:false))
};
c.isSelected=function(){return this.selected||false
};
c.isSelectable=function(){return d.isBool(this.effectiveOptions().staticState)?false:(d.isBool(this.owner.options.staticState)?false:this.effectiveOptions().isSelectable)
};
c.isDeselectable=function(){return d.isBool(this.effectiveOptions().staticState)?false:(d.isBool(this.owner.options.staticState)?false:this.effectiveOptions().isDeselectable)
};
c.effectiveOptions=function(f){var e=d.updateProps({},this.owner.area_options,this.options,f||{},{id:this.areaId});
return e
};
c.effectiveRenderOptions=function(h,g){var e=this.effectiveOptions(g),f=d.updateProps({},e,e["render_"+h],{alt_image:this.owner.altImage(h)});
return f
};
c.changeState=function(f,e){if(a.isFunction(this.owner.options.onStateChange)){this.owner.options.onStateChange.call(this.owner.image,{key:this.key,state:f,selected:e})
}};
c.highlight=function(e){var f=this.owner;
if(!e){f.graphics.addShapeGroup(this,"highlight")
}f.setHighlightID(this.areaId);
this.changeState("highlight",true)
};
c.drawSelection=function(){this.owner.graphics.addShapeGroup(this,"select")
};
c.addSelection=function(){var e=this.owner;
if(e.options.singleSelect){e.clearSelections()
}this.drawSelection();
this.selected=true;
this.changeState("select",true);
if(e.options.singleSelect){e.graphics.refreshSelections()
}};
c.removeSelection=function(e){this.selected=false;
this.changeState("select",false);
this.owner.graphics.removeSelections(this.areaId);
if(!e){this.owner.removeSelectionFinish()
}};
c.toggleSelection=function(e){if(!this.isSelected()){this.addSelection()
}else{this.removeSelection(e)
}return this.isSelected()
};
b.MapArea=function(g,e){if(!g){return
}var f=this;
f.owner=g;
f.area=e;
f.originalCoords=[];
a.each(d.split(e.coords),function(j,h){f.originalCoords.push(parseFloat(h))
});
f.length=f.originalCoords.length;
f.shape=e.shape.toLowerCase();
f.nohref=e.nohref||!e.href
};
b.MapArea.prototype.coords=function(){return this.originalCoords
}
}(jQuery));
(function(a){a.mapster.utils.areaCorners=function(f,q,i){var n,o,l,m,d,b,e,c,g,h,p,k;
n=o=d=e=999999;
l=m=b=c=-1;
for(k=f.length-2;
k>=0;
k-=2){g=parseInt(f[k],10);
h=parseInt(f[k+1],10);
if(g<n){n=g;
c=h
}if(g>l){l=g;
e=h
}if(h<o){o=h;
b=g
}if(h>m){m=h;
d=g
}}if(q&&i){a([[b-q,o-i],[d,o-i],[n-q,c-i],[n-q,e],[c-i,l],[e,l],[b-q,m],[d,m]]).each(function(r,j){if(j[0]>0&&j[1]>0){p=j;
return false
}})
}return{tl:[n,o],br:[l,m],tt:p}
}
}(jQuery));
(function(a){var b=a.mapster,d=b.utils,c=b.MapArea.prototype;
b.utils.getScaleInfo=function(h,g,i,e){var f;
if(!i&&!e){f=1
}else{f=i/h||e/g;
if(f>0.98&&f<1.02){f=1
}}return{scale:(f!==1),scalePct:f,realWidth:h,realHeight:g,width:i,height:e,ratio:i/e}
};
b.utils.scaleMap=function(h,n,e){var j,l,m,o,g,i=a(h),k=this;
if(!i.length){return
}o=i.width();
g=i.height();
function f(){if(!l){l=this.height;
m=this.width;
e(k.getScaleInfo(m,l,o,g))
}}if(n){j=new Image();
j.onload=f;
j.src=h.src;
if(j.width&&j.height){f.call(j)
}}else{l=g;
m=o
}};
b.MapData.prototype.resize=function(n,l,f){var j,p,r,i,e,o={},m,g,k=this;
if(typeof n==="object"){o=n
}else{o.width=n;
o.height=l;
o.duration=f
}r=o.width;
i=o.height;
e=o.duration||1000;
if(k.scaleInfo.width===r&&k.scaleInfo.height===i){return
}j=k._highlightId;
function q(s,u,t){if(a.mapster.hasCanvas){s.width=u;
s.height=t
}else{a(s).width(u);
a(s).height(t)
}}function h(){q(k.overlay_canvas,r,i);
if(o.highlight){if(j>=0){var s=k.data[j];
s.tempOptions={fade:false};
k.getDataForKey(s.key).highlight();
s.tempOptions=null
}}q(k.base_canvas,r,i);
k.redrawSelections();
k.resizing=false;
if(a.isFunction(o.callback)){o.callback()
}}if(!r){p=i/k.scaleInfo.realHeight;
r=Math.round(k.scaleInfo.realWidth*p)
}if(!i){p=r/k.scaleInfo.realWidth;
i=Math.round(k.scaleInfo.realHeight*p)
}m={width:String(r)+"px",height:String(i)+"px"};
if(!a.mapster.hasCanvas){a(k.base_canvas).children().remove()
}g=a(k.wrapper).find(".mapster_el");
if(k.resizing&&o.force){a(g).stop()
}k.resizing=true;
if(o.duration){g.each(function(t,s){a(s).animate(m,{duration:e,complete:t===0?h:null,easing:"linear"})
});
a(k.wrapper).animate({scrollLeft:o.scrollLeft||0,scrollTop:o.scrollTop||0},{duration:e,easing:"linear"})
}else{g.css(m);
h()
}a(this.image).css(m);
k.scaleInfo=d.getScaleInfo(k.scaleInfo.realWidth,k.scaleInfo.realHeight,r,i);
a.each(k.data,function(t,s){a.each(s.areas,function(v,u){u.resize()
})
})
};
b.MapArea=d.subclass(b.MapArea,function(){if(this.owner.scaleInfo.scale){this.resize()
}});
c.coords=function(k,e){var f,g=[],i=k||this.owner.scaleInfo.scalePct,h=e||0;
if(i===1&&e===0){return this.originalCoords
}for(f=0;
f<this.length;
f++){g.push(Math.round(this.originalCoords[f]*i)+h)
}return g
};
c.resize=function(){this.area.coords=this.coords().join(",")
};
c.reset=function(){this.area.coords=this.coords(1).join(",")
};
b.impl.resize=function(g,f,e){if(!g&&!f){return false
}return(new b.Method(this,function(){this.resize(g,f,e)
},null,{name:"resize",args:arguments})).go()
};
b.impl.zoom=function(e,g){var f=g||{};
function h(i){var w,j,m,A,t,k,l,u,v,q,r,p,o,y,z,s=f.padding||0,x=i?20:0,n=this,B=false;
if(i){if(!n.zoomed){n.zoomed=true;
n.preZoomWidth=n.scaleInfo.width;
n.preZoomHeight=n.scaleInfo.height;
n.zoomedArea=i;
if(f.scroll){n.wrapper.css({overflow:"auto"})
}}j=a.mapster.utils.areaCorners(i.coords(1,0));
A=n.wrapper.innerWidth()-x-s*2;
m=n.wrapper.innerHeight()-x-s*2;
k=j.maxX-j.minX;
l=j.maxY-j.minY;
u=A/k;
v=m/l;
t=Math.min(u,v);
q=(A-k*t)/2;
r=(m-l*t)/2;
p=n.scaleInfo.realWidth*t;
o=n.scaleInfo.realHeight*t;
y=(j.minX)*t-s-q;
z=(j.minY)*t-s-r
}else{if(!n.zoomed){return
}B=true;
p=n.preZoomWidth;
o=n.preZoomHeight;
y=null;
z=null
}this.resize({width:p,height:o,duration:f.duration,scroll:w,scrollLeft:y,scrollTop:z,callback:(function(){var D=B,E=f.scroll,C=i;
return function(){if(D){n.preZoomWidth=null;
n.preZoomHeight=null;
n.zoomed=false;
n.zoomedArea=false;
if(E){n.wrapper.css({overflow:"inherit"})
}}else{n.zoomedArea=C
}}
}())})
}return(new b.Method(this,function(i){h.call(this)
},function(){h.call(this.owner,this)
},{name:"zoom",args:arguments,first:true,key:e})).go()
}
}(jQuery));
(function(a){var b=a.mapster,c=b.utils;
b.defaults.toolTipContainer='<div class="mapster-tooltip" style="border: 2px solid black; background: #EEEEEE; position:absolute; width:160px; padding:4px; margin: 4px; -moz-box-shadow: 3px 3px 5px #535353; -webkit-box-shadow: 3px 3px 5px #535353; box-shadow: 3px 3px 5px #535353; -moz-border-radius: 6px 6px 6px 6px; -webkit-border-radius: 6px; border-radius: 6px 6px 6px 6px;"></div>';
b.MapData.prototype.clearTooltip=function(){if(this.activeToolTip){this.activeToolTip.remove();
this.activeToolTip=null;
this.activeToolTipID=-1
}a.each(this._tooltip_events,function(f,d){d.object.unbind(d.event)
})
};
b.MapData.prototype.bindTooltipClose=function(h,d,g){var e=d+".mapster-tooltip",f=this;
if(a.inArray(h,this.options.toolTipClose)>=0){g.unbind(e).bind(e,function(){f.clearTooltip()
});
this._tooltip_events.push({object:g,event:e})
}};
b.AreaData.prototype.showTooltip=function(){var l,h,n,m,f,g,e,j=this.effectiveOptions(),i=this.owner,d=i.options,k=i.options.toolTipContainer;
if(i.activeToolTipID===this.areaId){return
}if(typeof k==="string"){e=a(k)
}else{e=a(k).clone()
}l=e.html(j.toolTip).hide();
if(this.area){g=c.split(this.area.coords,",")
}else{g=[];
a.each(this.areas,function(p,o){g=g.concat(o.coords())
})
}i.clearTooltip();
a(i.image).after(l);
i.activeToolTip=l;
i.activeToolTipID=this.areaId;
f=c.areaCorners(g,l.outerWidth(true),l.outerHeight(true));
h=f.tt[0];
n=f.tt[1];
m={left:h+"px",top:n+"px"};
if(!l.css("z-index")||l.css("z-index")==="auto"){m["z-index"]="2000"
}l.css(m).addClass("mapster_tooltip");
i.bindTooltipClose("area-click","click",a(i.map));
i.bindTooltipClose("tooltip-click","click",l);
if(i.options.toolTipFade){c.setOpacity(l[0],0);
l.show();
c.fader(l[0],0,1,j.fadeDuration)
}else{l.show()
}c.ifFunction(d.onShowToolTip,this.area||null,{toolTip:l,areaOptions:j,key:this.key,selected:this.isSelected()})
};
b.impl.tooltip=function(d){return(new b.Method(this,function(){this.clearTooltip()
},function(){if(this.effectiveOptions().toolTip){this.showTooltip()
}},{name:"tooltip",args:arguments,key:d})).go()
}
}(jQuery));