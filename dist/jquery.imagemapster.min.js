/* ImageMapster
   Version: see $.mapster.version

Copyright 2011 James Treworgy
http://www.outsharked.com/imagemapster
https://github.com/jamietre/ImageMapster

A jQuery plugin to enhance image maps.
*/
(function(a){a.fn.mapster=function(d){var c=a.mapster.impl;if(a.isFunction(c[d])){return c[d].apply(this,Array.prototype.slice.call(arguments,1));
}else{if(typeof d==="object"||!d){return c.bind.apply(this,arguments);}else{a.error("Method "+d+" does not exist on jQuery.mapster");
}}};a.mapster={version:"1.2.4.048",render_defaults:{isSelectable:true,isDeselectable:true,fade:false,fadeDuration:150,altImage:null,fill:true,fillColor:"000000",fillColorMask:"FFFFFF",fillOpacity:0.7,highlight:null,stroke:false,strokeColor:"ff0000",strokeOpacity:1,strokeWidth:1,includeKeys:"",alt_image:null},defaults:{wrapClass:null,wrapCss:null,onGetList:null,sortList:false,listenToList:false,mapKey:"",mapValue:"",singleSelect:false,listKey:"value",listSelectedAttribute:"selected",listSelectedClass:null,onClick:null,onMouseover:null,onMouseout:null,mouseoutDelay:0,onStateChange:null,boundList:null,onConfigured:null,configTimeout:10000,noHrefIsMask:true,scaleMap:true,safeLoad:false,areas:[]},shared_defaults:{render_highlight:{fade:true},render_select:{fade:false},staticState:null,selected:null},area_defaults:{includeKeys:"",isMask:false},canvas_style:{position:"absolute",left:0,top:0,padding:0,border:0},hasCanvas:null,isTouch:null,windowLoaded:false,map_cache:[],hooks:{},addHook:function(d,c){this.hooks[d]=(this.hooks[d]||[]).push(c);
},callHooks:function(d,c){a.each(this.hooks[d]||[],function(g,f){f.apply(c);});},utils:{subclass:function(c,d){var e=function(){var g=this,f=Array.prototype.slice.call(arguments,0);
g.base=c.prototype;g.base.init=function(){c.prototype.constructor.apply(g,f);};d.apply(g,f);
};e.prototype=new c();e.prototype.constructor=e;return e;},asArray:function(c){return c.constructor===Array?c:this.split(c);
},split:function(g,d){var f,e,c=g.split(",");for(f=c.length-1;f>=0;f--){e=a.trim(c[f]);
c[f]=d?d(e):e;if(!c[f]){c=c.splice(f,1);}}return c;},setOpacity:function(c,f){if(!a.mapster.hasCanvas){var d=a(c);
d.children().add(d).each(function(h,g){g.style.filter="Alpha(opacity="+String(f*100)+");";
});}else{c.style.opacity=f;}},updateProps:function(c,d){var e,f=c||{},g=a.isEmptyObject(f)?d:c;
e=[];a.each(g,function(h){e.push(h);});a.each(Array.prototype.slice.call(arguments,1),function(h,j){a.each(j||{},function(k){if(!e||a.inArray(k,e)>=0){var i=j[k];
if(a.isPlainObject(i)){f[k]=a.extend(f[k]||{},i);}else{if(i&&i.constructor===Array){f[k]=i.slice(0);
}else{if(typeof i!=="undefined"){f[k]=j[k];}}}}});});return f;},isElement:function(c){return(typeof HTMLElement==="object"?c instanceof HTMLElement:c&&typeof c==="object"&&c.nodeType===1&&typeof c.nodeName==="string");
},indexOfProp:function(c,d,f){var e=c.constructor===Array?-1:null;a.each(c,function(h,g){if(g&&(d?g[d]:g)===f){e=h;
return false;}});return e;},boolOrDefault:function(d,c){return this.isBool(d)?d:c||false;
},isBool:function(c){return typeof c==="boolean";},ifFunction:function(d,e,c){if(a.isFunction(d)){d.call(e,c);
}},isImageLoaded:function(c){if(typeof c.complete!=="undefined"&&!c.complete){return false;
}if(typeof c.naturalWidth!=="undefined"&&(c.naturalWidth===0||c.naturalHeight===0)){return false;
}return true;},fader:(function(){var c={},e=0,d=function(g,k,h,f){var i,j,l=a.mapster.utils;
if(typeof g==="number"){j=c[g];if(!j){return;}}else{i=l.indexOfProp(c,null,g);if(i){delete c[i];
}c[++e]=j=g;g=e;}h=h||1;k=(k+(h/10)>h-0.01)?h:k+(h/10);l.setOpacity(j,k);if(k<h){setTimeout(function(){d(g,k,h,f);
},f?f/10:15);}};return d;}())},getBoundList:function(g,e){if(!g.boundList){return null;
}var c,d,h=a(),f=a.mapster.utils.split(e);g.boundList.each(function(k,j){for(c=0;
c<f.length;c++){d=f[c];if(a(j).is("["+g.listKey+'="'+d+'"]')){h=h.add(j);}}});return h;
},setBoundListProperties:function(c,e,d){e.each(function(g,f){if(c.listSelectedClass){if(d){a(f).addClass(c.listSelectedClass);
}else{a(f).removeClass(c.listSelectedClass);}}if(c.listSelectedAttribute){a(f).attr(c.listSelectedAttribute,d);
}});},getMapDataIndex:function(e){var d,c;switch(e.tagName&&e.tagName.toLowerCase()){case"area":c=a(e).parent().attr("name");
d=a("img[usemap='#"+c+"']")[0];break;case"img":d=e;break;}return d?this.utils.indexOfProp(this.map_cache,"image",d):-1;
},getMapData:function(d){var c=this.getMapDataIndex(d);if(c>=0){return c>=0?this.map_cache[c]:null;
}},queueCommand:function(e,f,d,c){if(!e){return false;}if(!e.complete){e.commands.push({that:f,command:d,args:c});
return true;}return false;},unload:function(){this.impl.unload();this.utils=null;
this.impl=null;a.fn.mapster=null;a.mapster=null;a("*").unbind();}};var b=a.mapster;
b.Method=function(g,d,c,f){var e=this;e.name=f.name;e.output=g;e.input=g;e.first=f.first||false;
e.args=f.args?Array.prototype.slice.call(f.args,0):[];e.key=f.key;e.func_map=d;e.func_area=c;
e.name=f.name;};b.Method.prototype.go=function(){var f,e,c,g,j,k=this.input,d=[],h=this;
g=k.length;for(f=0;f<g;f++){e=a.mapster.getMapData(k[f]);if(e){if(b.queueCommand(e,h.input,h.name,h.args)){if(this.first){j="";
}continue;}c=e.getData(k[f].nodeName==="AREA"?k[f]:this.key);if(c){if(a.inArray(c,d)<0){d.push(c);
}}else{j=this.func_map.apply(e,h.args);}if(this.first||typeof j!=="undefined"){break;
}}}a(d).each(function(m,l){j=h.func_area.apply(l,h.args);});if(typeof j!=="undefined"){return j;
}else{return this.output;}};a.mapster.impl=(function(){var e={},d=a.mapster,i=a.mapster.utils,h,c;
c=function(j){return d.map_cache.push(j)-1;};h=function(k){d.map_cache.splice(k.index,1);
for(var j=d.map_cache.length-1;j>=this.index;j--){d.map_cache[j].index--;}};function f(n,k){var j,l,m=n.options.areas;
if(k){a.each(k,function(p,o){l=i.indexOfProp(m,"key",this.key);if(l>=0){a.extend(m[l],this);
}else{m.push(this);}j=n.getDataForKey(this.key);if(j){a.extend(j.options,this);}});
}}function g(j,k){var l=i.updateProps({},k);delete l.areas;i.updateProps(j.options,l);
f(j,k.areas);i.updateProps(j.area_options,j.options);}e.get=function(j){return(new d.Method(this,function(){return this.getSelected();
},function(){return this.isSelected();},{name:"get",args:arguments,key:j,first:true,defaultReturn:""})).go();
};e.data=function(j){return(new d.Method(this,null,function(){return this;},{name:"data",args:arguments,key:j})).go();
};e.highlight=function(j){return(new d.Method(this,function(l){if(j===false){this.ensureNoHighlight();
}else{var k=this.highlightId;return k>=0?this.data[k].key:null;}},function(){this.highlight();
},{name:"highlight",args:arguments,key:j,first:true})).go();};e.select=function(){e.set.call(this,true);
};e.deselect=function(){e.set.call(this,false);};e.set=function(r,n,s){var p,q,l,o,k;
function t(u){if(u){switch(r){case true:u.addSelection();break;case false:u.removeSelection(true);
break;default:u.toggleSelection();break;}}}function j(u){if(a.inArray(u,k)<0){k.push(u);
o+=(o===""?"":",")+u.key;}}function m(u){a.each(k,function(w,v){t(v);});if(!r){u.removeSelectionFinish();
}if(l&&u.options.boundList){d.setBoundListProperties(u.options,d.getBoundList(u.options,o),r);
}}l=i.isBool(s)?s:true;this.each(function(v,u){var w;q=d.getMapData(u);if(q!==p){if(p){m(p);
}k=[];o="";}if(q){w="";if(a(u).is("img")){if(!d.queueCommand(q,a(u),"set",[r,n,l])){if(n instanceof Array){if(n.length){w=n.join(",");
}}else{w=n;}if(w){a.each(i.split(w),function(x,y){j(q.getDataForKey(y.toString()));
p=q;});}}}else{if(!d.queueCommand(q,a(u),"set",[r,n,l])){j(q.getDataForArea(u));p=q;
}}}});if(q){m(q);}return this;};e.unbind=function(j){return(new d.Method(this,function(){this.clearEvents();
this.clearMapData(j);h(this);},null,{name:"unbind",args:arguments})).go();};e.rebind=function(j,k){return(new d.Method(this,function(){if(k){this.options=i.updateProps({},d.defaults,j);
a.each(this.data,function(m,l){l.options={};});}g(this,j);this.setAreaOptions(j.areas||{});
this.redrawSelections();},null,{name:"rebind",args:arguments})).go();};e.get_options=function(l,k){var j=i.isBool(l)?l:k;
return(new d.Method(this,function(){var m=a.extend({},this.options);if(j){m.render_select=i.updateProps({},d.render_defaults,m,m.render_select);
m.render_highlight=i.updateProps({},d.render_defaults,m,m.render_highlight);}return m;
},function(){return j?this.effectiveOptions():this.options;},{name:"get_options",args:arguments,first:true,key:l})).go();
};e.set_options=function(j){return(new d.Method(this,function(){g(this,j);},null,{name:"set_options",args:arguments})).go();
};e.unload=function(){var j;for(j=d.map_cache.length-1;j>=0;j--){if(d.map_cache[j]){e.unbind.call(a(d.map_cache[j].image));
}}e.graphics=null;};e.snapshot=function(){return(new d.Method(this,function(){a.each(this.data,function(k,j){j.selected=false;
});this.base_canvas=this.graphics.createVisibleCanvas(this.image);a(this.image).before(this.base_canvas);
},null,{name:"snapshot"})).go();};e.state=function(){var j,k=null;a(this).each(function(m,l){if(l.nodeName==="IMG"){j=d.getMapData(l);
if(j){k=j.state();}return false;}});return k;};e.bind=function(j){var k=i.updateProps({},d.defaults,j);
return this.each(function(m,l){var n,o,q,p;n=a(l);n.css("border",0);p=d.getMapData(l);
if(p){e.unbind.apply(n);if(!p.complete){n.bind();return true;}p=null;}q=this.getAttribute("usemap");
o=q&&a('map[name="'+q.substr(1)+'"]');if(!(n.is("img")&&q&&o.size()>0)){return true;
}if(!p){p=new d.MapData(this,k);p.index=c(p);p.map=o;p.addImage(this);p.addImage(null,this.src);
if(a.mapster.hasCanvas){p.addImage(null,k.render_highlight.altImage||k.altImage,"highlight");
p.addImage(null,k.render_select.altImage||k.altImage,"select");}p.bindImages();}});
};e.init=function(l){var k,j;d.hasCanvas=(document.namespaces&&document.namespaces.g_vml_)?false:a("<canvas></canvas>")[0].getContext?true:false;
d.isTouch="ontouchstart" in document.documentElement;if(!(d.hasCanvas||document.namespaces)){a.fn.mapster=function(){return this;
};return;}if(!i.isBool(a.mapster.defaults.highlight)){d.render_defaults.highlight=!d.isTouch;
}a.extend(d.defaults,d.render_defaults,d.shared_defaults);a.extend(d.area_defaults,d.render_defaults,d.shared_defaults);
if(i.isBool(l)){d.hasCanvas=l;}if(a.browser.msie&&!d.hasCanvas&&!document.namespaces.v){document.namespaces.add("v","urn:schemas-microsoft-com:vml");
k=document.createStyleSheet();j=["shape","rect","oval","circ","fill","stroke","imagedata","group","textbox"];
a.each(j,function(n,m){k.addRule("v\\:"+m,"behavior: url(#default#VML); antialias:true");
});}a(window).bind("load",function(){d.windowLoaded=true;a(d.map_cache).each(function(n,m){if(!m.complete&&m.isReadyToBind()){m.initialize();
}});});};e.test=function(j){return eval(j);};return e;}());a.mapster.impl.init();
}(jQuery));(function(a){var c,b=a.mapster,d=b.utils;b.Graphics=function(e){var f=this;
f.active=false;f.canvas=null;f.width=0;f.height=0;f.shapes=[];f.masks=[];f.map_data=e;
};c=b.Graphics.prototype;c.begin=function(f,g){var e=a(f);this.elementName=g;this.canvas=f;
this.width=e.width();this.height=e.height();this.shapes=[];this.masks=[];this.active=true;
};c.addShape=function(f,g){var e=g.isMask?this.masks:this.shapes;e.push({mapArea:f,options:g});
};c.createVisibleCanvas=function(e){return a(this.createCanvasFor(e)).addClass("mapster_el").css(b.canvas_style)[0];
};c._addShapeGroupImpl=function(e,h){var g=this,f=g.map_data,i=e.effectiveRenderOptions(h);
a.each(e.areas(),function(k,j){i.isMask=i.isMask||(j.nohref&&f.options.noHrefIsMask);
g.addShape(j,i);});};c.addShapeGroup=function(e,j){var i=this,g,k,f,h=this.map_data,l=e.effectiveRenderOptions(j);
if(j==="select"){k="static_"+e.areaId.toString();f=h.base_canvas;}else{f=h.overlay_canvas;
}i.begin(f,k);if(l.includeKeys){g=d.split(l.includeKeys);a.each(g,function(o,n){var m=h.getDataForKey(n.toString());
i._addShapeGroupImpl(m,j);});}i._addShapeGroupImpl(e,j);i.render();if(l.fade){d.fader(f,0,(b.hasCanvas?1:l.fillOpacity),l.fadeDuration);
}};b.initGraphics=function(){if(b.hasCanvas){c.hex_to_decimal=function(e){return Math.max(0,Math.min(parseInt(e,16),255));
};c.css3color=function(e,f){return"rgba("+this.hex_to_decimal(e.substr(0,2))+","+this.hex_to_decimal(e.substr(2,2))+","+this.hex_to_decimal(e.substr(4,2))+","+f+")";
};c.renderShape=function(f,h,j){var g,e=h.coords(null,j);switch(h.shape){case"rect":f.rect(e[0],e[1],e[2]-e[0],e[3]-e[1]);
break;case"poly":f.moveTo(e[0],e[1]);for(g=2;g<h.length;g+=2){f.lineTo(e[g],e[g+1]);
}f.lineTo(e[0],e[1]);break;case"circ":case"circle":f.arc(e[0],e[1],e[2],0,Math.PI*2,false);
break;}};c.addAltImage=function(e,f,g,h){e.beginPath();this.renderShape(e,g);e.closePath();
e.clip();e.globalAlpha=h.altImageOpacity||h.fillOpacity;e.drawImage(f,0,0,g.owner.scaleInfo.width,g.owner.scaleInfo.height);
};c.render=function(){var g,h,i=this,f=i.masks.length,j=i.createCanvasFor(i.canvas),k=j.getContext("2d"),e=i.canvas.getContext("2d");
if(f){g=i.createCanvasFor(i.canvas);h=g.getContext("2d");h.clearRect(0,0,g.width,g.height);
a.each(i.masks,function(m,l){h.save();h.beginPath();i.renderShape(h,l.mapArea);h.closePath();
h.clip();h.lineWidth=0;h.fillStyle="#000";h.fill();h.restore();});}a.each(i.shapes,function(l,m){k.save();
if(m.options.fill){if(m.options.alt_image){i.addAltImage(k,m.options.alt_image,m.mapArea,m.options);
}else{k.beginPath();i.renderShape(k,m.mapArea);k.closePath();k.fillStyle=i.css3color(m.options.fillColor,m.options.fillOpacity);
k.fill();}}k.restore();});a.each(i.shapes.concat(i.masks),function(l,n){var m=n.options.strokeWidth===1?0.5:0;
if(n.options.stroke){k.save();k.strokeStyle=i.css3color(n.options.strokeColor,n.options.strokeOpacity);
k.lineWidth=n.options.strokeWidth;k.beginPath();i.renderShape(k,n.mapArea,m);k.closePath();
k.stroke();k.restore();}});if(f){h.globalCompositeOperation="source-out";h.drawImage(j,0,0);
e.drawImage(g,0,0);}else{e.drawImage(j,0,0);}i.active=false;return i.canvas;};c.createCanvasFor=function(g){var f=a(g),j=f.width()||f[0].width,i=f.height()||f[0].height,e=a('<canvas width="'+j+'" height="'+i+'"></canvas>')[0];
return e;};c.clearHighlight=function(){var e=this.map_data.overlay_canvas;e.getContext("2d").clearRect(0,0,e.width,e.height);
};c.removeSelections=function(){};c.refreshSelections=function(){var e,f=this.map_data;
e=f.base_canvas;f.base_canvas=this.createVisibleCanvas(f.image);a(f.base_canvas).hide();
a(e).before(f.base_canvas);f.redrawSelections();a(f.base_canvas).show();a(e).remove();
};}else{c.renderShape=function(k,m,g){var l=this,n,h,o,j,i,p,f=k.coords();j=l.elementName?'name="'+l.elementName+'" ':"";
i=g?'class="'+g+'" ':"";o='<v:fill color="#'+m.fillColor+'" opacity="'+(m.fill?m.fillOpacity:0)+'" /><v:stroke opacity="'+m.strokeOpacity+'"/>';
if(m.stroke){n="strokeweight="+m.strokeWidth+' stroked="t" strokecolor="#'+m.strokeColor+'"';
}else{n='stroked="f"';}switch(k.shape){case"rect":p="<v:rect "+i+j+' filled="t" '+n+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+f[0]+"px;top:"+f[1]+"px;width:"+(f[2]-f[0])+"px;height:"+(f[3]-f[1])+'px;">'+o+"</v:rect>";
break;case"poly":p="<v:shape "+i+j+' filled="t" '+n+' coordorigin="0,0" coordsize="'+l.width+","+l.height+'" path="m '+f[0]+","+f[1]+" l "+f.slice(2).join(",")+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+l.width+"px;height:"+l.height+'px;">'+o+"</v:shape>";
break;case"circ":case"circle":p="<v:oval "+i+j+' filled="t" '+n+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(f[0]-f[2])+"px;top:"+(f[1]-f[2])+"px;width:"+(f[2]*2)+"px;height:"+(f[2]*2)+'px;">'+o+"</v:oval>";
break;}h=a(p);a(l.canvas).append(h);return h;};c.render=function(){var f,e=this;a.each(this.shapes,function(h,g){e.renderShape(g.mapArea,g.options);
});if(this.masks.length){a.each(this.masks,function(h,g){f=d.updateProps({},g.options,{fillOpacity:1,fillColor:g.options.fillColorMask});
e.renderShape(g.mapArea,f,"mapster_mask");});}this.active=false;return this.canvas;
};c.createCanvasFor=function(f){var e=a(f),i=e.width(),g=e.height();return a('<var width="'+i+'" height="'+g+'" style="zoom:1;overflow:hidden;display:block;width:'+i+"px;height:"+g+'px;"></var>')[0];
};c.clearHighlight=function(){a(this.map_data.overlay_canvas).children().remove();
};c.removeSelections=function(e){if(e>=0){a(this.map_data.base_canvas).find('[name="static_'+e.toString()+'"]').remove();
}else{a(this.map_data.base_canvas).children().remove();}};c.refreshSelections=function(){return null;
};}};b.initGraphics();}(jQuery));(function(a){var c,b=a.mapster,d=b.utils;b.MapData=function(e,g){var f=this;
function h(l,i,j){function k(m){if(f.currentAreaId!==m&&f.highlightId>=0){j();}}if(f.activeAreaEvent){window.clearTimeout(f.activeAreaEvent);
f.activeAreaEvent=0;}if(l<0){return;}if(i.owner.resizing||l){f.activeAreaEvent=window.setTimeout((function(){return function(){h(0,i,j);
};}(i)),l||100);}else{k(i.areaId);}}this.index=-1;this.currentAreaId=-1;this.image=e;
this.options=g;this.activeAreaEvent=null;this.area_options=d.updateProps({},b.area_defaults,g);
this.bindTries=g.configTimeout/200;this.imgCssText=e.style.cssText||null;this.initializeDefaults();
this.mousedown=function(i){i.preventDefault();if(!a.mapster.hasCanvas){this.blur();
}};this.mouseover=function(k){var j=f.getAllDataForArea(this),i=j.length?j[0]:null,l;
if(!i||i.isNotRendered()||i.owner.resizing){return;}l=i.effectiveOptions();if(f.currentAreaId===i.areaId){return;
}if(f.highlightId!==i.areaId){f.clearEffects();i.highlight(!l.highlight);if(f.options.showToolTip){a.each(j,function(n,m){if(m.effectiveOptions().toolTip){m.showTooltip();
}});}}f.currentAreaId=i.areaId;if(a.isFunction(f.options.onMouseover)){f.options.onMouseover.call(this,{e:k,options:l,key:i.key,selected:i.isSelected()});
}};this.mouseout=function(j){var k,l,i=f.getDataForArea(this),m=f.options;if(f.currentAreaId<0||!i){return;
}l=f.getDataForArea(j.relatedTarget);if(l===i){return;}f.currentAreaId=-1;i.area=null;
h(m.mouseoutDelay,i,f.clearEffects);if(a.isFunction(m.onMouseout)){m.onMouseout.call(this,{e:j,options:m,key:k,selected:i.isSelected()});
}};this.clearEffects=function(){var i=f.options;f.ensureNoHighlight();if(i.toolTipClose&&a.inArray("area-mouseout",i.toolTipClose)>=0&&f.activeToolTip){f.clearTooltip();
}};this.click=function(m){var r,n,o,p,j,k,s,t=this,i=f.getDataForArea(this),q=f.options;
function l(u){var v;j=(u.isSelectable()&&(u.isDeselectable()||!u.isSelected()));if(j){p=!u.isSelected();
}else{p=u.isSelected();}o=b.getBoundList(q,u.key);if(a.isFunction(q.onClick)){k=q.onClick.call(t,{e:m,listTarget:o,key:u.key,selected:p});
if(d.isBool(k)){if(!k){return false;}s=a(u.area).attr("href");if(s!=="#"){window.location.href=s;
return false;}}}if(j){r=u.toggleSelection();}if(q.boundList&&q.boundList.length>0){b.setBoundListProperties(q,o,u.isSelected());
}v=u.effectiveOptions();if(v.includeKeys){n=d.split(v.includeKeys);a.each(n,function(y,x){var w=f.getDataForKey(x.toString());
if(!w.options.isMask){l(w);}});}}m.preventDefault();if(i&&!i.owner.resizing){if(!a.mapster.hasCanvas){this.blur();
}q=f.options;l(i);}};this.graphics=new b.Graphics(this);};c=b.MapData.prototype;c.initializeDefaults=function(){this.images=[];
this.imageSources=[];this.imageStatus=[];this.altImagesXref={};this.map=null;this.base_canvas=null;
this.overlay_canvas=null;this.imagesAdded=false;this.imagesLoaded=false;this.complete=false;
this.commands=[];this.data=[];this.mapAreas=[];this.originalAreaData=[];this._xref={};
this.highlightId=-1;this.currentAreaId=-1;this._tooltip_events=[];this.scaleInfo=null;
};c.state=function(){return{complete:this.complete,resizing:this.resizing,zoomed:this.zoomed,zoomedArea:this.zoomedArea,scaleInfo:this.scaleInfo};
};c.isReadyToBind=function(){return this.imagesAdded&&this.imagesLoaded&&(!this.options.safeLoad||b.windowLoaded);
};c.addImage=function(g,l,e){var h,f,k,i=this;function j(){if(i.complete){return;
}h=a.inArray(this,i.images);if(h<0){throw ("Unable to find ref to image '"+this.src+"'.");
}i.imageStatus[h]=true;if(a.inArray(false,i.imageStatus)<0&&(!i.options.safeLoad||b.windowLoaded)){i.initialize();
}}function m(n){var o=i.images.push(n)-1;i.imageSources[o]=k;i.imageStatus[o]=false;
if(e){i.altImagesXref[e]=o;}}if(!g&&!l){return;}f=g;k=l||a(f).attr("src");if(!k){throw ("Missing image source");
}if(!f){f=a('<img class="mapster_el" />').hide()[0];a("body").append(f);m(f);a(f).bind("load.mapster",j);
a(f).attr("src",k);}else{m(f);}};c.bindImages=function(g){var e=true,f=this;f.imagesAdded=true;
if(f.complete){return;}a.each(f.images,function(j,h){if(!d.isImageLoaded(h)){e=false;
return false;}});f.imagesLoaded=e;if(f.isReadyToBind()){f.initialize();return;}if(f.bindTries-->0){window.setTimeout(function(){f.bindImages(true);
},200);}else{throw ("Images never seemed to finish loading.");}};c.altImage=function(e){return this.images[this.altImagesXref[e]];
};c.wrapId=function(){return"mapster_wrap_"+this.index;};c._idFromKey=function(e){return this.complete&&typeof e==="string"&&this._xref.hasOwnProperty(e)?this._xref[e]:-1;
};c.getSelected=function(){var e="";a.each(this.data,function(g,f){if(f.isSelected()){e+=(e?",":"")+this.key;
}});return e;};c.getAllDataForArea=function(f,g){var h,e,l,k=this,j=a(f).filter("area").attr(k.options.mapKey);
if(j){l=[];j=d.split(j);for(h=0;h<(g||j.length);h++){e=k.data[k._idFromKey(j[h])];
e.area=f.length?f[0]:f;l.push(e);}}return l;};c.getDataForArea=function(f){var e=this.getAllDataForArea(f,1);
return e?e[0]||null:null;};c.getDataForKey=function(e){return this.data[this._idFromKey(e)];
};c.getData=function(e){if(typeof e==="string"){return this.getDataForKey(e);}else{if(e&&e.mapster||d.isElement(e)){return this.getDataForArea(e);
}else{return null;}}};c.ensureNoHighlight=function(){var e;if(this.highlightId>=0){this.graphics.clearHighlight();
e=this.data[this.highlightId];e.changeState("highlight",false);this.setHighlightId(-1);
}};c.setHighlightId=function(e){this.highlightId=e;};c.clearSelections=function(){a.each(this.data,function(g,f){if(f.selected){f.removeSelection(true);
}});this.removeSelectionFinish();};c.setAreaOptions=function(f){var j,g,e,h=f||{};
for(j=h.length-1;j>=0;j--){g=h[j];e=this.getDataForKey(g.key);if(e){d.updateProps(e.options,g);
if(d.isBool(g.selected)){e.selected=g.selected;}}}};c.drawSelections=function(g){var e,f=d.asArray(g);
for(e=f.length-1;e>=0;e--){this.data[f[e]].drawSelection();}};c.redrawSelections=function(){a.each(this.data,function(g,f){if(f.isSelectedOrStatic()){f.drawSelection();
}});};c.initialize=function(){var t,l,B,H,C,e,g,m,E,k,r,u,w,v,h,p,q,s,F,G,o,x,D,n,y,z=this,A=z.options;
function f(j,I){var i=new b.AreaData(z,j,I);i.areaId=z._xref[j]=z.data.push(i)-1;
return i.areaId;}if(z.complete){return;}z.complete=true;s=a(z.image);C=s.parent().attr("id");
if(C&&C.length>=12&&C.substring(0,12)==="mapster_wrap"){H=s.parent();H.attr("id",z.wrapId());
}else{H=a('<div id="'+z.wrapId()+'"></div>');if(A.wrapClass){if(A.wrapClass===true){H.addClass(s.attr("class"));
}else{H.addClass(A.wrapClass);}}}z.wrapper=H;l=z.graphics.createVisibleCanvas(z.image);
B=z.graphics.createVisibleCanvas(z.image);z.base_canvas=l;z.overlay_canvas=B;z._xref={};
z.data=[];p=!A.mapKey;if(p){A.mapKey="data-mapster-key";}E=(a.browser.msie&&a.browser.version<=7)?"area":(p?"area[coords]":"area["+A.mapKey+"]");
k=a(z.map).find(E);z.scaleInfo=D=d.scaleMap(s,z.images[1],A.scaleMap);t=a(z.images[0]).clone().addClass("mapster_el").attr({id:null,usemap:null});
a.each(["width","height","padding","border","margin"],function(I,j){t.css(j,s.css(j));
});z.images[1]=t[0];for(r=k.length-1;r>=0;r--){h=0;g=k[r];e=a(g);if(!g.coords){continue;
}n=p?"":g.getAttribute(A.mapKey);x=new b.MapArea(z,g,p||!n?"":n);w=x.keys;z.mapAreas.push(x);
y=z.mapAreas.length-1;for(u=w.length-1;u>=0;u--){v=w[u];if(A.mapValue){q=e.attr(A.mapValue);
}if(p){h=f(z.data.length,q);o=z.data[h];o.key=v=h.toString();}else{h=z._xref[v];if(h>=0){o=z.data[h];
if(q&&!z.data[h].value){o.value=q;}}else{h=f(v,q);o=z.data[h];}}x.areaDataXref.push(h);
o.areasXref.push(y);}if(!x.nohref){e.bind("mouseover.mapster",z.mouseover).bind("mouseout.mapster",z.mouseout).bind("click.mapster",z.click).bind("mousedown.mapster",z.mousedown);
}if(p){e.attr("data-mapster-key",v);x.keys=[v];}}m={display:"block",position:"relative",padding:0,width:D.width,height:D.height};
if(A.wrapCss){a.extend(m,A.wrapCss);}if(s.parent()[0]!==z.wrapper[0]){s.before(z.wrapper);
}H.css(m);a(z.images.slice(2)).hide();for(r=1;r<z.images.length;r++){H.append(z.images[r]);
}H.append(l).append(B).append(s.css(b.canvas_style));d.setOpacity(z.images[0],0);
a(z.images[1]).show();d.setOpacity(z.images[1],1);z.setAreaOptions(A.areas);if(A.isSelectable&&A.onGetList){G=z.data.slice(0);
if(A.sortList){if(A.sortList==="desc"){F=function(i,j){return i===j?0:(i>j?-1:1);
};}else{F=function(i,j){return i===j?0:(i<j?-1:1);};}G.sort(function(i,j){i=i.value;
j=j.value;return F(i,j);});}z.options.boundList=A.onGetList.call(z.image,G);}z.redrawSelections();
if(z.commands.length){a.each(z.commands,function(I,j){b.impl[j.command].apply(j.that,j.args);
});z.commands=[];}if(A.onConfigured&&typeof A.onConfigured==="function"){A.onConfigured.call(s,true);
}};c.clearEvents=function(){a(this.map).find("area").unbind(".mapster");a(this.images).unbind(".mapster");
};c._clearCanvases=function(e){if(!e){a(this.base_canvas).remove();}a(this.overlay_canvas).remove();
};c.clearMapData=function(f){var e=this;this._clearCanvases(f);a.each(this.data,function(h,g){g.reset();
});this.data=null;if(!f){this.image.style.cssText=this.imgCssText;a(this.wrapper).before(this.image).remove();
}a.each(this.images,function(h,g){if(e.images[h]!==g.image){e.images[h]=null;}});
e.images=[];this.image=null;d.ifFunction(this.clearTooltip,this);};c.removeSelectionFinish=function(){var e=this.graphics;
e.refreshSelections();e.clearHighlight();};}(jQuery));(function(a){var c,b=a.mapster,d=b.utils;
b.AreaData=function(f,e,g){a.extend(this,{owner:f,key:e||"",areaId:-1,value:g||"",options:{},selected:null,areasXref:[],area:null,optsCache:null});
};c=b.AreaData.prototype;c.areas=function(){var e,f=[];for(e=0;e<this.areasXref.length;
e++){f.push(this.owner.mapAreas[this.areasXref[e]]);}return f;};c.coords=function(f){var e=[];
a.each(this.areas(),function(h,g){e=e.concat(g.coords(f));});return e;};c.reset=function(){a.each(this.areas(),function(g,f){f.reset();
});this.areasXref=[];this.options=null;};c.isSelectedOrStatic=function(){var e=this.effectiveOptions();
return d.isBool(e.staticState)?e.staticState:this.isSelected();};c.isSelected=function(){return d.isBool(this.selected)?this.selected:d.isBool(this.owner.area_options.selected)?this.owner.area_options.selected:false;
};c.isSelectable=function(){return d.isBool(this.effectiveOptions().staticState)?false:(d.isBool(this.owner.options.staticState)?false:d.boolOrDefault(this.effectiveOptions().isSelectable,true));
};c.isDeselectable=function(){return d.isBool(this.effectiveOptions().staticState)?false:(d.isBool(this.owner.options.staticState)?false:d.boolOrDefault(this.effectiveOptions().isDeselectable,true));
};c.isNotRendered=function(){var e=a(this.area);return e.attr("nohref")||!e.attr("href")||this.effectiveOptions().isMask;
};c.effectiveOptions=function(f){var e=d.updateProps({},this.owner.area_options,this.options,f||{},{id:this.areaId});
e.selected=this.isSelected();return e;};c.effectiveRenderOptions=function(f,h){var e,g=this.optsCache;
if(!g||f==="highlight"){e=this.effectiveOptions(h);g=d.updateProps({},e,e["render_"+f],{alt_image:this.owner.altImage(f)});
if(f!=="highlight"){this.optsCache=g;}}return g;};c.changeState=function(f,e){if(a.isFunction(this.owner.options.onStateChange)){this.owner.options.onStateChange.call(this.owner.image,{key:this.key,state:f,selected:e});
}};c.highlight=function(e){var f=this.owner;if(!e){f.graphics.addShapeGroup(this,"highlight");
}f.setHighlightId(this.areaId);this.changeState("highlight",true);};c.drawSelection=function(){this.owner.graphics.addShapeGroup(this,"select");
};c.addSelection=function(){var e=this.owner;if(e.options.singleSelect){e.clearSelections();
}this.drawSelection();this.selected=true;this.changeState("select",true);if(e.options.singleSelect){e.graphics.refreshSelections();
}};c.removeSelection=function(e){this.selected=false;this.changeState("select",false);
this.optsCache=null;this.owner.graphics.removeSelections(this.areaId);if(!e){this.owner.removeSelectionFinish();
}};c.toggleSelection=function(e){if(!this.isSelected()){this.addSelection();}else{this.removeSelection(e);
}return this.isSelected();};b.MapArea=function(h,e,f){if(!h){return;}var g=this;g.owner=h;
g.area=e;g.areaDataXref=[];g.originalCoords=[];a.each(d.split(e.coords),function(k,j){g.originalCoords.push(parseFloat(j));
});g.length=g.originalCoords.length;g.shape=e.shape.toLowerCase();g.nohref=e.nohref||!e.href;
g.keys=d.split(f);};b.MapArea.prototype.reset=function(){this.area=null;};b.MapArea.prototype.coords=function(e){return a.map(this.originalCoords,function(f){return e?f:f+e;
});};}(jQuery));(function(a){var b=a.mapster.utils;b.areaCorners=function(e,x,o){var n,t,u,r,s,h,f,i,g,l,m,v,q,p,w,c,d,k=[];
for(q=0;q<e.length;q++){d=e[q];p=b.split(d.coords,parseInt);switch(d.shape){case"circle":l=p[0];
m=p[1];w=p[2];k=[];for(q=0;q<360;q+=20){c=q*Math.PI/180;k.push(l+w*Math.cos(c),m+w*Math.sin(c));
}break;case"rect":k.push(p[0],p[1],p[2],p[1],p[2],p[3],p[0],p[3]);break;default:k=k.concat(p);
break;}}t=u=h=i=999999;r=s=f=g=-1;for(q=k.length-2;q>=0;q-=2){l=parseInt(k[q],10);
m=parseInt(k[q+1],10);if(l<t){t=l;g=m;}if(l>r){r=l;i=m;}if(m<u){u=m;f=l;}if(m>s){s=m;
h=l;}}if(x&&o){n=false;a.each([[f-x,u-o],[h,u-o],[t-x,g-o],[t-x,i],[g-o,r],[i,r],[f-x,s],[h,s]],function(y,j){if(!n&&(j[0]>0&&j[1]>0)){v=j;
n=true;return false;}});if(!n){v=[r,s];}}return{tl:[t,u],br:[r,s],tt:v};};}(jQuery));
(function(a){var b=a.mapster,d=b.utils,c=b.MapArea.prototype;b.utils.getScaleInfo=function(h,g,i,e){var f;
if(!i&&!e){f=1;}else{f=i/h||e/g;if(f>0.98&&f<1.02){f=1;}}return{scale:(f!==1),scalePct:f,realWidth:h,realHeight:g,width:i,height:e,ratio:i/e};
};b.utils.scaleMap=function(f,g,l){var j,k,m,e,h=a(f),i=a(g);m=h.width();e=h.height();
k=i.width();j=i.height();return this.getScaleInfo(k,j,m,e);};b.MapData.prototype.resize=function(n,l,f){var j,p,r,i,e,o={},m,g,k=this;
if(typeof n==="object"){o=n;}else{o.width=n;o.height=l;o.duration=f;}r=o.width;i=o.height;
e=o.duration||1000;if(k.scaleInfo.width===r&&k.scaleInfo.height===i){return;}j=k.highlightId;
function q(s,u,t){if(a.mapster.hasCanvas){s.width=u;s.height=t;}else{a(s).width(u);
a(s).height(t);}}function h(){q(k.overlay_canvas,r,i);if(o.highlight){if(j>=0){var s=k.data[j];
s.tempOptions={fade:false};k.getDataForKey(s.key).highlight();s.tempOptions=null;
}}q(k.base_canvas,r,i);k.redrawSelections();k.resizing=false;if(a.isFunction(o.callback)){o.callback();
}}if(!r){p=i/k.scaleInfo.realHeight;r=Math.round(k.scaleInfo.realWidth*p);}if(!i){p=r/k.scaleInfo.realWidth;
i=Math.round(k.scaleInfo.realHeight*p);}m={width:String(r)+"px",height:String(i)+"px"};
if(!a.mapster.hasCanvas){a(k.base_canvas).children().remove();}g=a(k.wrapper).find(".mapster_el");
if(k.resizing&&o.force){a(g).stop();}k.resizing=true;if(o.duration){g.each(function(t,s){a(s).animate(m,{duration:e,complete:t===0?h:null,easing:"linear"});
});a(k.wrapper).animate({scrollLeft:o.scrollLeft||0,scrollTop:o.scrollTop||0},{duration:e,easing:"linear"});
}else{g.css(m);h();}a(this.image).css(m);k.scaleInfo=d.getScaleInfo(k.scaleInfo.realWidth,k.scaleInfo.realHeight,r,i);
a.each(k.data,function(t,s){a.each(s.areas(),function(v,u){u.resize();});});};b.MapArea=d.subclass(b.MapArea,function(){this.base.init();
if(this.owner.scaleInfo.scale){this.resize();}});c.coords=function(k,e){var f,g=[],i=k||this.owner.scaleInfo.scalePct,h=e||0;
if(i===1&&e===0){return this.originalCoords;}for(f=0;f<this.length;f++){g.push(Math.round(this.originalCoords[f]*i)+h);
}return g;};c.resize=function(){this.area.coords=this.coords().join(",");};c.reset=function(){this.area.coords=this.coords(1).join(",");
};b.impl.resize=function(g,f,e){if(!g&&!f){return false;}return(new b.Method(this,function(){this.resize(g,f,e);
},null,{name:"resize",args:arguments})).go();};b.impl.zoom=function(e,g){var f=g||{};
function h(i){var w,j,m,A,t,k,l,u,v,q,r,p,o,y,z,s=f.padding||0,x=i?20:0,n=this,B=false;
if(i){if(!n.zoomed){n.zoomed=true;n.preZoomWidth=n.scaleInfo.width;n.preZoomHeight=n.scaleInfo.height;
n.zoomedArea=i;if(f.scroll){n.wrapper.css({overflow:"auto"});}}j=a.mapster.utils.areaCorners(i.coords(1,0));
A=n.wrapper.innerWidth()-x-s*2;m=n.wrapper.innerHeight()-x-s*2;k=j.maxX-j.minX;l=j.maxY-j.minY;
u=A/k;v=m/l;t=Math.min(u,v);q=(A-k*t)/2;r=(m-l*t)/2;p=n.scaleInfo.realWidth*t;o=n.scaleInfo.realHeight*t;
y=(j.minX)*t-s-q;z=(j.minY)*t-s-r;}else{if(!n.zoomed){return;}B=true;p=n.preZoomWidth;
o=n.preZoomHeight;y=null;z=null;}this.resize({width:p,height:o,duration:f.duration,scroll:w,scrollLeft:y,scrollTop:z,callback:(function(){var D=B,E=f.scroll,C=i;
return function(){if(D){n.preZoomWidth=null;n.preZoomHeight=null;n.zoomed=false;n.zoomedArea=false;
if(E){n.wrapper.css({overflow:"inherit"});}}else{n.zoomedArea=C;}};}())});}return(new b.Method(this,function(i){h.call(this);
},function(){h.call(this.owner,this);},{name:"zoom",args:arguments,first:true,key:e})).go();
};}(jQuery));(function(a){var b=a.mapster,c=b.utils;a.extend(b.defaults,{toolTipContainer:'<div class="mapster-tooltip" style="border: 2px solid black; background: #EEEEEE; position:absolute; width:160px; padding:4px; margin: 4px; -moz-box-shadow: 3px 3px 5px #535353; -webkit-box-shadow: 3px 3px 5px #535353; box-shadow: 3px 3px 5px #535353; -moz-border-radius: 6px 6px 6px 6px; -webkit-border-radius: 6px; border-radius: 6px 6px 6px 6px;"></div>',showToolTip:false,toolTipFade:true,toolTipClose:["area-mouseout"],onShowToolTip:null,onCreateTooltip:null});
a.extend(b.area_defaults,{toolTip:null});b.MapData.prototype.clearTooltip=function(){if(this.activeToolTip){this.activeToolTip.stop().remove();
this.activeToolTip=null;this.activeToolTipID=-1;}a.each(this._tooltip_events,function(f,d){d.object.unbind(d.event);
});};b.MapData.prototype.bindTooltipClose=function(h,d,g){var e=d+".mapster-tooltip",f=this;
if(a.inArray(h,this.options.toolTipClose)>=0){g.unbind(e).bind(e,function(){f.clearTooltip();
});this._tooltip_events.push({object:g,event:e});}};b.AreaData.prototype.showTooltip=function(){var l,h,n,m,g,d,f,j=this.effectiveOptions(),i=this.owner,e=i.options,k=i.options.toolTipContainer;
i.cancelClear=true;if(i.activeToolTipID===this.areaId){return;}if(typeof k==="string"){f=a(k);
}else{f=a(k).clone();}l=f.html(j.toolTip).hide();i.clearTooltip();a(i.image).after(l);
i.activeToolTip=l;i.activeToolTipID=this.areaId;c.setOpacity(l[0],0);l.show();d=this.area?[this.area]:a.map(this.areas(),function(o){return o.area;
});g=c.areaCorners(d,l.outerWidth(true),l.outerHeight(true));h=g.tt[0];n=g.tt[1];
m={left:h+"px",top:n+"px"};if(!l.css("z-index")||l.css("z-index")==="auto"){m["z-index"]="2000";
}l.css(m).addClass("mapster_tooltip");i.bindTooltipClose("area-click","click",a(i.map));
i.bindTooltipClose("tooltip-click","click",l);if(i.options.toolTipFade){c.fader(l[0],0,1,j.fadeDuration);
}else{c.setOpacity(l[0],1);}c.ifFunction(e.onShowToolTip,this.area||null,{toolTip:l,areaOptions:j,key:this.key,selected:this.isSelected()});
};b.impl.tooltip=function(d){return(new b.Method(this,function(){this.clearTooltip();
},function(){if(this.effectiveOptions().toolTip){this.showTooltip();}},{name:"tooltip",args:arguments,key:d})).go();
};}(jQuery));