$.mapster.utils={subclass:function subclass(Obj,constr){var proto=new Obj(),sub=function(){constr.apply(proto);return proto};sub.prototype=proto.constructor.prototype;return sub},split:function(text){var arr=text.split(',');return $.each(arr,function(i){arr[i]=$.trim(arr[i])})},setOpacity:function(e,opacity){if(!$.mapster.hasCanvas){e.style.filter="Alpha(opacity="+String(opacity*100)+")"}else{e.style.opacity=opacity}},mergeObjects:function(options){var obj,i,len,prop,u=this,add=this.boolOrDefault(options.add,options.template?false:true),ignore=options.ignore?u.split(options.ignore):'',include=options.include?u.split(options.include):'',deep=options.deep?u.split(options.deep):'',target=options.target||{},source=[].concat(options.source);if(options.template){target=this.mergeObjects({target:{},source:[options.template,target]})}len=source.length;for(i=0;i<len;i++){obj=source[i];if(obj){for(prop in obj){if((!ignore||$.inArray(prop,ignore)<0)&&(!include||$.inArray(prop,include)>=0)&&obj.hasOwnProperty(prop)&&(add||target.hasOwnProperty(prop))){if(deep&&$.inArray(prop,deep)>=0&&typeof obj[prop]==='object'){if(typeof target[prop]!=='object'&&add){target[prop]={}}this.mergeObjects({target:target[prop],source:obj[prop],add:add})}else{target[prop]=this.clone(obj[prop])}}}}}return target},clone:function(obj){var prop,i,target,len;if($.isArray(obj)){target=[];len=obj.length;for(i=0;i<len;i++){target.push(obj[i])}}else if(obj&&obj.clone){target=obj.clone()}else if(typeof obj==='object'&&obj&&!obj.nodeName){target={};for(prop in obj){if(obj.hasOwnProperty(prop)){target[prop]=obj[prop]}}}else{target=obj}return target},isElement:function(o){return(typeof HTMLElement==="object"?o instanceof HTMLElement:o&&typeof o==="object"&&o.nodeType===1&&typeof o.nodeName==="string")},indexOfProp:function(obj,prop,val){var result=typeof obj.constructor===Array?-1:null;$.each(obj,function(i,e){if(e&&(prop?e[prop]:e)===val){result=i;return false}});return result},boolOrDefault:function(obj,def){return this.isBool(obj)?obj:def||false},isBool:function(obj){return typeof obj==="boolean"},ifFunction:function(obj,that,args){if($.isFunction(obj)){obj.call(that,args)}},isImageLoaded:function(img){if(typeof img.complete!=='undefined'&&!img.complete){return false}if(typeof img.naturalWidth!=='undefined'&&(img.naturalWidth===0||img.naturalHeight===0)){return false}return true},fader:(function(){var elements={},lastKey=0,fade_func=function(el,op,endOp,duration){var index,u=$.mapster.utils,obj;if(typeof el==='number'){obj=elements[el];if(!obj){return}}else{index=u.indexOfProp(elements,null,el);if(index){delete elements[index]}elements[++lastKey]=obj=el;el=lastKey}endOp=endOp||1;op=(op+(endOp/ 10) > endOp - 0.01) ? endOp : op + (endOp /10);u.setOpacity(obj,op);if(op<endOp){setTimeout(function(){fade_func(el,op,endOp,duration)},duration?duration/10:15)}};return fade_func}())};
